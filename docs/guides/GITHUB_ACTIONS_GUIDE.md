# GitHub Actions è‡ªåŠ¨æ„å»º Android APK æŒ‡å—

## ğŸ“‹ æ¦‚è¿°

æœ¬é¡¹ç›®å·²é…ç½® GitHub Actions è‡ªåŠ¨æ„å»ºç³»ç»Ÿï¼Œæ¯æ¬¡æ¨é€ä»£ç åˆ° GitHub éƒ½ä¼šè‡ªåŠ¨ç”Ÿæˆ Android APK æ–‡ä»¶ã€‚

---

## ğŸš€ å¦‚ä½•è§¦å‘æ„å»º

### æ–¹æ³• 1: ä»£ç æ¨é€è‡ªåŠ¨è§¦å‘ï¼ˆæ¨èï¼‰

æ¯æ¬¡å°†ä»£ç æ¨é€åˆ° `main` æˆ– `master` åˆ†æ”¯æ—¶è‡ªåŠ¨è§¦å‘ï¼š

```bash
# åœ¨é¡¹ç›®æ ¹ç›®å½•
git add .
git commit -m "feat: æ·»åŠ æ–°åŠŸèƒ½"
git push origin main
```

âœ… **æ¨é€åä¼šè‡ªåŠ¨**ï¼š
- å®‰è£…ä¾èµ–
- æ„å»º Web åº”ç”¨
- åˆå§‹åŒ– Android é¡¹ç›®
- ç¼–è¯‘ APK
- ä¸Šä¼ åˆ° GitHub

### æ–¹æ³• 2: æ‰‹åŠ¨è§¦å‘æ„å»º

1. æ‰“å¼€ GitHub ä»“åº“é¡µé¢
2. ç‚¹å‡» `Actions` æ ‡ç­¾
3. é€‰æ‹© `Build Android APK` å·¥ä½œæµ
4. ç‚¹å‡» `Run workflow` æŒ‰é’®
5. é€‰æ‹©åˆ†æ”¯ï¼Œç‚¹å‡» `Run workflow`

### æ–¹æ³• 3: åˆ›å»º Release ç‰ˆæœ¬

```bash
# æ‰“æ ‡ç­¾è§¦å‘
git tag v1.0.0
git push origin v1.0.0
```

âœ… **è‡ªåŠ¨åˆ›å»º GitHub Release**ï¼ŒAPK ä¼šé™„åŠ åœ¨ Release ä¸­

---

## ğŸ“¦ ä¸‹è½½æ„å»ºçš„ APK

### ä» Artifacts ä¸‹è½½ï¼ˆæ¯æ¬¡æ„å»ºï¼‰

1. è¿›å…¥ GitHub ä»“åº“çš„ `Actions` é¡µé¢
2. ç‚¹å‡»æœ€æ–°çš„æ„å»ºè®°å½•ï¼ˆç»¿è‰²å‹¾è¡¨ç¤ºæˆåŠŸï¼‰
3. æ»šåŠ¨åˆ°é¡µé¢åº•éƒ¨æ‰¾åˆ° `Artifacts` åŒºåŸŸ
4. ç‚¹å‡» `sugarsmart-ai-debug-xxx` ä¸‹è½½ ZIP æ–‡ä»¶
5. è§£å‹å¾—åˆ° `app-debug.apk`

**ä¿ç•™æ—¶é—´**ï¼š30 å¤©

### ä» Releases ä¸‹è½½ï¼ˆæ‰“æ ‡ç­¾æ—¶ï¼‰

1. è¿›å…¥ GitHub ä»“åº“çš„ `Releases` é¡µé¢
2. æ‰¾åˆ°å¯¹åº”ç‰ˆæœ¬
3. åœ¨ Assets åŒºåŸŸä¸‹è½½ APK æ–‡ä»¶

**ä¿ç•™æ—¶é—´**ï¼šæ°¸ä¹…

---

## ğŸ“± å®‰è£… APK åˆ°æ‰‹æœº

### Android æ‰‹æœºå®‰è£…æ­¥éª¤

1. **ä¸‹è½½ APK**
   - ä½¿ç”¨æ‰‹æœºæµè§ˆå™¨è®¿é—® GitHub Artifacts é“¾æ¥
   - æˆ–é€šè¿‡ç”µè„‘ä¸‹è½½åä¼ è¾“åˆ°æ‰‹æœº

2. **å…è®¸æœªçŸ¥æ¥æº**
   - æ‰“å¼€æ‰‹æœº `è®¾ç½®` > `å®‰å…¨` > `æœªçŸ¥æ¥æº`
   - å…è®¸ä»è¯¥æ¥æºå®‰è£…åº”ç”¨

3. **å®‰è£…åº”ç”¨**
   - ç‚¹å‡»ä¸‹è½½çš„ APK æ–‡ä»¶
   - ç‚¹å‡» `å®‰è£…`
   - ç­‰å¾…å®‰è£…å®Œæˆ

4. **æ‰“å¼€åº”ç”¨**
   - åœ¨åº”ç”¨åˆ—è¡¨æ‰¾åˆ°"æ™ºç³–ç®¡å®¶AI"
   - ç‚¹å‡»å›¾æ ‡æ‰“å¼€

---

## â±ï¸ æ„å»ºæ—¶é—´

| æ„å»ºé˜¶æ®µ | æ—¶é—´ | è¯´æ˜ |
|---------|------|------|
| é¦–æ¬¡æ„å»º | 8-12 åˆ†é’Ÿ | éœ€è¦ä¸‹è½½ Android SDK |
| åç»­æ„å»º | 5-8 åˆ†é’Ÿ | ä½¿ç”¨ç¼“å­˜åŠ é€Ÿ |
| å¤±è´¥é‡è¯• | 3-5 åˆ†é’Ÿ | åˆ©ç”¨å·²ç¼“å­˜çš„ä¾èµ– |

---

## ğŸ”§ æ„å»ºçŠ¶æ€æŸ¥çœ‹

### æŸ¥çœ‹æ„å»ºè¿›åº¦

1. æ¨é€ä»£ç åï¼Œè®¿é—® `https://github.com/ä½ çš„ç”¨æˆ·å/sugarsmart-ai/actions`
2. ç‚¹å‡»æœ€æ–°çš„æ„å»ºè®°å½•
3. å®æ—¶æŸ¥çœ‹æ¯ä¸ªæ­¥éª¤çš„æ‰§è¡Œæƒ…å†µ

### æ„å»ºçŠ¶æ€æ ‡è¯†

- âœ… **ç»¿è‰²å‹¾**ï¼šæ„å»ºæˆåŠŸ
- âŒ **çº¢è‰²å‰**ï¼šæ„å»ºå¤±è´¥
- ğŸŸ¡ **é»„è‰²åœ†**ï¼šæ­£åœ¨æ„å»ºä¸­
- â¸ï¸ **ç°è‰²ç‚¹**ï¼šç­‰å¾…æ‰§è¡Œ

---

## ğŸ› å¸¸è§é—®é¢˜æ’æŸ¥

### Q1: æ„å»ºå¤±è´¥ - "pnpm install failed"

**åŸå› **ï¼šä¾èµ–å®‰è£…å¤±è´¥

**è§£å†³æ–¹æ¡ˆ**ï¼š
```bash
# æœ¬åœ°æµ‹è¯•ä¾èµ–å®‰è£…
pnpm install
pnpm --filter @sugarsmart/mobile build

# å¦‚æœæœ¬åœ°æ­£å¸¸ï¼Œæ£€æŸ¥ package.json æ˜¯å¦æ­£ç¡®æäº¤
git status
git add packages/mobile/package.json
git commit -m "fix: ä¿®å¤ä¾èµ–é…ç½®"
git push
```

### Q2: æ„å»ºå¤±è´¥ - "gradlew assembleDebug failed"

**åŸå› **ï¼šAndroid æ„å»ºé”™è¯¯

**è§£å†³æ–¹æ¡ˆ**ï¼š
1. æ£€æŸ¥ `capacitor.config.ts` é…ç½®
2. ç¡®ä¿ `appId` æ ¼å¼æ­£ç¡®ï¼ˆå¦‚ `com.sugarsmart.ai`ï¼‰
3. æŸ¥çœ‹æ„å»ºæ—¥å¿—ä¸­çš„å…·ä½“é”™è¯¯ä¿¡æ¯

### Q3: APK æ— æ³•ä¸‹è½½

**åŸå› **ï¼šArtifacts å·²è¿‡æœŸï¼ˆ30å¤©åï¼‰

**è§£å†³æ–¹æ¡ˆ**ï¼š
- é‡æ–°è§¦å‘æ„å»º
- æˆ–è€…ä½¿ç”¨ Release ç‰ˆæœ¬ï¼ˆæ°¸ä¹…ä¿ç•™ï¼‰

### Q4: æ‰‹æœºæ— æ³•å®‰è£… APK

**åŸå› **ï¼šç­¾åé—®é¢˜æˆ–ç³»ç»Ÿé™åˆ¶

**è§£å†³æ–¹æ¡ˆ**ï¼š
1. ç¡®è®¤å·²å…è®¸"æœªçŸ¥æ¥æº"å®‰è£…
2. Debug APK å¯èƒ½è¢«éƒ¨åˆ†æ‰‹æœºå“ç‰Œæ‹¦æˆª
3. è€ƒè™‘ä½¿ç”¨ Release ç­¾åç‰ˆæœ¬

---

## ğŸ“Š æ„å»ºé…ç½®è¯´æ˜

### å·¥ä½œæµæ–‡ä»¶ä½ç½®

`.github/workflows/build-android.yml`

### ä¸»è¦æ„å»ºæ­¥éª¤

1. **Checkout ä»£ç **ï¼šä¸‹è½½æœ€æ–°ä»£ç 
2. **Setup Node.js**ï¼šå®‰è£… Node.js 20
3. **Setup Java**ï¼šå®‰è£… Java 17ï¼ˆAndroid æ„å»ºéœ€è¦ï¼‰
4. **Setup pnpm**ï¼šå®‰è£…åŒ…ç®¡ç†å™¨
5. **Install dependencies**ï¼šå®‰è£…é¡¹ç›®ä¾èµ–
6. **Build shared**ï¼šæ„å»ºå…±äº«åŒ…
7. **Build mobile**ï¼šæ„å»º React åº”ç”¨
8. **Setup Android SDK**ï¼šé…ç½® Android å¼€å‘ç¯å¢ƒ
9. **Initialize Android**ï¼šåˆå§‹åŒ– Capacitor Android é¡¹ç›®
10. **Build APK**ï¼šç¼–è¯‘ Android APK
11. **Upload Artifact**ï¼šä¸Šä¼ æ„å»ºäº§ç‰©

### ç¯å¢ƒå˜é‡

å½“å‰ä½¿ç”¨é»˜è®¤é…ç½®ï¼Œå¦‚éœ€è‡ªå®šä¹‰ï¼š

```yaml
env:
  NODE_VERSION: '20'
  JAVA_VERSION: '17'
  PNPM_VERSION: '8'
```

---

## ğŸ” ç­¾åé…ç½®ï¼ˆè¿›é˜¶ï¼‰

å½“å‰æ„å»ºçš„æ˜¯ **Debug APK**ï¼ˆæœªç­¾åï¼‰ï¼Œé€‚åˆå¼€å‘æµ‹è¯•ã€‚

### é…ç½® Release ç­¾å

1. **ç”Ÿæˆå¯†é’¥åº“**

```bash
keytool -genkey -v -keystore sugarsmart-release.keystore \
  -alias sugarsmart -keyalg RSA -keysize 2048 -validity 10000
```

2. **æ·»åŠ  GitHub Secrets**

è¿›å…¥ä»“åº“ `Settings` > `Secrets` > `Actions`ï¼Œæ·»åŠ ï¼š
- `KEYSTORE_FILE`ï¼šå¯†é’¥åº“æ–‡ä»¶ï¼ˆBase64 ç¼–ç ï¼‰
- `KEYSTORE_PASSWORD`ï¼šå¯†é’¥åº“å¯†ç 
- `KEY_ALIAS`ï¼šå¯†é’¥åˆ«å
- `KEY_PASSWORD`ï¼šå¯†é’¥å¯†ç 

3. **æ›´æ–°å·¥ä½œæµ**

ä¿®æ”¹ `.github/workflows/build-android.yml`ï¼Œæ›¿æ¢ `assembleDebug` ä¸º `assembleRelease`

---

## ğŸ“ˆ ä¼˜åŒ–å»ºè®®

### åŠ é€Ÿæ„å»º

1. **ç¼“å­˜ä¾èµ–**ï¼ˆå·²å¯ç”¨ï¼‰
   - pnpm ç¼“å­˜
   - Gradle ç¼“å­˜
   - Android SDK ç¼“å­˜

2. **å¹¶è¡Œæ„å»º**

```yaml
strategy:
  matrix:
    build-type: [debug, release]
```

3. **æ¡ä»¶è§¦å‘**

```yaml
on:
  push:
    branches: [main]
    paths:
      - 'packages/mobile/**'
      - 'packages/shared/**'
```

### æ„å»ºé€šçŸ¥

æ·»åŠ é’‰é’‰/ä¼ä¸šå¾®ä¿¡/é‚®ä»¶é€šçŸ¥ï¼š

```yaml
- name: Send notification
  if: always()
  run: |
    curl -X POST "webhook_url" \
      -d '{"text":"APKæ„å»ºå®Œæˆ"}'
```

---

## ğŸ“š ç›¸å…³æ–‡æ¡£

- [Capacitor å®˜æ–¹æ–‡æ¡£](https://capacitorjs.com/)
- [GitHub Actions æ–‡æ¡£](https://docs.github.com/cn/actions)
- [Android å¼€å‘è€…æŒ‡å—](https://developer.android.com/)

---

## ğŸ†˜ è·å–å¸®åŠ©

é‡åˆ°é—®é¢˜ï¼Ÿ

1. æŸ¥çœ‹ [GitHub Actions æ—¥å¿—](https://github.com/ä½ çš„ç”¨æˆ·å/sugarsmart-ai/actions)
2. æ£€æŸ¥ [Issues](https://github.com/ä½ çš„ç”¨æˆ·å/sugarsmart-ai/issues)
3. æäº¤æ–° Issue æè¿°é—®é¢˜

---

## âœ… æ£€æŸ¥æ¸…å•

é…ç½®å®Œæˆåï¼Œç¡®è®¤ä»¥ä¸‹äº‹é¡¹ï¼š

- [ ] `.github/workflows/build-android.yml` æ–‡ä»¶å·²åˆ›å»º
- [ ] ä»£ç å·²æ¨é€åˆ° GitHub
- [ ] Actions æ ‡ç­¾é¡µå¯ä»¥çœ‹åˆ°å·¥ä½œæµ
- [ ] é¦–æ¬¡æ„å»ºå·²æˆåŠŸå®Œæˆ
- [ ] APK å¯ä»¥ä» Artifacts ä¸‹è½½
- [ ] APK å¯ä»¥åœ¨æ‰‹æœºä¸Šå®‰è£…è¿è¡Œ

---

**æœ€åæ›´æ–°**ï¼š2025-12-02

**ç»´æŠ¤è€…**ï¼šSugarSmart AI Team

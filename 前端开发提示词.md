# 智糖管家AI - 前端开发任务

## 你的角色
你是前端开发工程师,负责完成"智糖管家AI"糖尿病营养管理应用的前端开发工作。

## 当前项目状态
- **代码位置**: `/home/devbox/project/sugarsmart-ai/`
- **技术栈**: React 19.2 + TypeScript + Vite + Tailwind CSS
- **完成度**: 约50%(基础UI完成,数据层待完善)
- **已完成模块**: 
  - ✅ 用户档案录入(LandingView, InputPage)
  - ✅ 饮食计划展示(ResultPage, RecipeCard)
  - ✅ 食谱详情(DetailPage)
  - ✅ 个人中心(MinePage)
  - ✅ 帮助中心、健康档案、周报等辅助组件

## 核心任务清单

### 任务1: 完善Dashboard热量追踪功能(优先级:🔥高)
**背景**: 当前Dashboard显示硬编码热量数据(650/850/1500千卡)

**要求**:
1. 实现动态热量计算
   - 使用`utils/calorieCalculator.ts`(如已存在则完善,否则创建)
   - 基于用户档案(年龄/体重/身高/性别)计算每日目标热量
   - 累计当日meal plan的calories计算已摄入热量
   - 计算剩余可摄入 = 目标 - 已摄入

2. 修改`App.tsx`中的`DashboardView`组件
   - 导入计算函数
   - 替换硬编码数值为动态计算结果
   - 处理边界情况(无用户档案/无meal plan时的默认值)

**参考代码**:
```typescript
// utils/calorieCalculator.ts
import { UserProfile, MealPlan, Gender } from '../types';

// Harris-Benedict公式计算BMR
export const calculateBMR = (profile: UserProfile): number => {
  const { age, weight, height, gender } = profile;
  
  if (gender === Gender.Male) {
    return 88.362 + (13.397 * weight) + (4.799 * height) - (5.677 * age);
  }
  return 447.593 + (9.247 * weight) + (3.098 * height) - (4.330 * age);
};

// 计算每日目标热量
export const calculateDailyTarget = (profile: UserProfile): number => {
  const bmr = calculateBMR(profile);
  const activityFactor = 1.375; // 默认轻度活动
  return Math.round(bmr * activityFactor);
};

// 计算已摄入热量
export const calculateConsumed = (mealPlan: MealPlan): number => {
  if (!mealPlan) return 0;
  return mealPlan.reduce((sum, recipe) => sum + recipe.nutrition.calories, 0);
};

// 计算剩余可摄入
export const calculateRemaining = (target: number, consumed: number): number => {
  return Math.max(0, target - consumed);
};
```

**交付标准**:
- Dashboard显示真实计算的热量数据
- 数据随用户档案和meal plan变化而更新
- 无控制台错误

---

### 任务2: 数据持久化与状态管理优化
**当前问题**: 使用localStorage,但数据同步逻辑可能不完善

**要求**:
1. 检查并完善`AppContext`中的localStorage逻辑
2. 确保以下数据正确保存和读取:
   - 用户档案(userProfile)
   - 饮食计划(mealPlan)
   - 收藏食谱(savedRecipes)
3. 实现数据版本控制(避免类型变更导致数据损坏)
4. 添加数据清理功能(可选,用于测试)

**参考代码**:
```typescript
// 数据版本控制
const STORAGE_VERSION = '1.0';
const STORAGE_KEYS = {
  VERSION: 'sugarsmart_version',
  USER_PROFILE: 'sugarsmart_user_profile',
  MEAL_PLAN: 'sugarsmart_meal_plan',
  SAVED_RECIPES: 'sugarsmart_saved_recipes'
};

// 检查版本并清理旧数据
const checkStorageVersion = () => {
  const currentVersion = localStorage.getItem(STORAGE_KEYS.VERSION);
  if (currentVersion !== STORAGE_VERSION) {
    // 版本不匹配,清理数据
    Object.values(STORAGE_KEYS).forEach(key => localStorage.removeItem(key));
    localStorage.setItem(STORAGE_KEYS.VERSION, STORAGE_VERSION);
  }
};
```

**交付标准**:
- 刷新页面后数据不丢失
- 用户修改档案后所有相关组件同步更新
- localStorage数据结构清晰可读

---

### 任务3: API接口预留与Mock数据管理
**背景**: 当前使用Gemini AI mock数据(`services/geminiService.ts`中`MOCK_MODE=true`)

**要求**:
1. 创建统一的API服务层 `services/apiClient.ts`
   ```typescript
   class ApiClient {
     private baseURL: string;
     private mockMode: boolean;
     
     constructor() {
       this.baseURL = import.meta.env.VITE_API_BASE_URL || 'http://localhost:3000';
       this.mockMode = import.meta.env.VITE_MOCK_MODE === 'true';
     }
     
     async getUserProfile(userId: string): Promise<UserProfile> {
       if (this.mockMode) {
         // 返回mock数据
         return mockUserProfile;
       }
       const response = await fetch(`${this.baseURL}/api/users/${userId}`);
       return response.json();
     }
     
     async saveMealPlan(plan: MealPlan): Promise<void> {
       if (this.mockMode) {
         localStorage.setItem('meal_plan', JSON.stringify(plan));
         return;
       }
       await fetch(`${this.baseURL}/api/meal-plan`, {
         method: 'POST',
         headers: { 'Content-Type': 'application/json' },
         body: JSON.stringify(plan)
       });
     }
   }
   
   export const apiClient = new ApiClient();
   ```

2. 定义所有需要的API接口(即使暂时mock):
   - **用户认证**: login, register
   - **用户档案**: getProfile, updateProfile
   - **饮食计划**: generatePlan, savePlan, getMealPlan
   - **血糖记录**: addGlucoseRecord, getGlucoseHistory
   - **收藏管理**: addFavorite, removeFavorite, getFavorites

3. 在`.env`中配置API地址
   ```env
   VITE_API_BASE_URL=http://localhost:3000
   VITE_MOCK_MODE=true
   ```

**交付标准**:
- 所有数据请求通过统一的apiClient
- 可通过环境变量轻松切换mock/真实API
- 接口定义清晰,有完整的TypeScript类型

---

### 任务4: UI细节优化与响应式适配
**要求**:
1. 确保所有页面在移动端(375px-428px)完美显示
2. 优化加载状态(Loading骨架屏)
3. 添加空状态提示(无数据时的友好提示)
4. 完善错误处理(API失败时的用户提示)
5. 增强交互反馈(按钮点击反馈、表单验证提示)

**参考竞品图片**:
- `/home/devbox/project/82c8eb6b3ee614f82e404d9531e82c31.jpg`
- 其他截图参考文件

**交付标准**:
- 视觉与交互达到商业应用水准
- 无明显的UI bug
- 符合Material Design或现代设计规范

---

### 任务5: 准备前后端联调
**要求**:
1. 在`README.md`中补充API文档需求说明
   ```markdown
   ## 后端API需求清单
   
   ### 1. 用户认证
   - POST /api/auth/register
     - Body: { username, password, nickname }
     - Response: { user, token }
   
   - POST /api/auth/login
     - Body: { username, password }
     - Response: { user, token }
   
   ### 2. 饮食计划
   - POST /api/meal-plan/generate
     - Body: UserProfile
     - Response: MealPlan
   
   - GET /api/meal-plan/:date
     - Response: MealPlan
   ```

2. 准备接口测试用例(Postman/Thunder Client)
3. 编写联调文档:
   - 前端需要的响应格式示例
   - 错误码定义
   - 认证方式(JWT token传递方式)

**交付标准**:
- API需求文档完整
- 提供清晰的数据格式示例
- 明确前端的依赖项

---

## 开发规范

### 代码风格
- 使用TypeScript严格模式
- 遵循现有代码风格(函数组件 + Hooks)
- 组件拆分合理,单个文件不超过500行
- 添加必要的注释(特别是复杂逻辑)

### Git提交规范
```
feat: 添加热量动态计算功能
fix: 修复Dashboard数据不刷新问题
refactor: 重构API服务层
docs: 更新API需求文档
```

### 测试要求
- 手动测试所有页面流程
- 测试边界情况(无数据、网络失败等)
- 记录发现的bug到`Git版本记录.md`

---

## 工作流程

### 每日工作流
1. 查看任务优先级,从高到低完成
2. 每完成一个任务,提交一次Git commit
3. 遇到问题及时在代码中添加TODO注释
4. 每日结束前更新进度到`README.md`

### 沟通机制
- 遇到需要后端支持的问题,在API文档中标注
- 发现设计问题,截图并说明建议改进方案
- 技术难点需要讨论时,准备好问题背景和尝试过的方案

---

## 重要提示

⚠️ **暂时不要实现**:
- 微信登录功能(等后端就绪)
- 真实的AI调用(保持mock模式)
- 支付相关功能
- 后端数据库直连

✅ **可以开始做**:
- 所有前端UI优化
- 数据计算逻辑
- 本地数据管理
- API接口预留

---

## 成功标准

完成以上5个任务后,项目应达到:
- ✅ 所有页面可正常操作
- ✅ 数据计算逻辑准确
- ✅ 用户体验流畅
- ✅ 代码结构清晰可维护
- ✅ 为后端联调做好准备

开始工作吧!有任何问题随时同步。
